<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Timed Audio Pages</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
  #timer { font-size: 24px; color: red; margin-bottom: 20px; }
  #content { display: block; }

  /* CSS to prevent native video controls from appearing on hover/focus */
  .video-hidden::-webkit-media-controls-enclosure {
    display: none !important;
  }
  .video-hidden::-moz-media-controls-enclosure {
    display: none !important;
  }
</style>
</head>
<body>
<h1>Listening Task</h1>
<div id="timer"></div>
<div id="content"></div>

<script>
let page = 1;
let timeLeft = 120; 

// --- Video Setup ---
const videoHTML = `
  <video 
    id="listeningVideo" 
    width="560" 
    height="315" 
    autoplay 
    class="video-hidden" 
    onended="handleVideoEnd()" 
    playsinline
  >
    <source src="video.mp4" type="video/mp4"> 
    Your browser does not support the video tag.
  </video>
`;

// Global handler for when the video naturally finishes playing
function handleVideoEnd() {
    // This removes the video and shows a message when the audio concludes
    document.getElementById('content').innerHTML = "<h2>Video has finished.</h2>";
}

// --- Timer Setup ---
// The timer runs independently of the video's actual length.
function startTimer() {
  const maxTime = 120;
  
  let timer = setInterval(() => {
    // Update the counter text
    document.getElementById('timer').innerText = `Page ${page}: ${timeLeft} seconds left`;
    
    if (timeLeft <= 0) {
      clearInterval(timer); // Stop the current timer
      
      if (page < 3) {
        // Advance to the next page and restart
        page++;
        timeLeft = maxTime; 
        startTimer(); 
      } else {
        // Task complete after 3 pages
        document.getElementById('content').innerHTML += "<h2>All time segments complete.</h2>";
        document.getElementById('timer').innerText = "";
      }
    }
    
    timeLeft--; // Decrease time left by 1 second
  }, 1000); 
}

document.addEventListener('DOMContentLoaded', () => {
    // 1. Insert the video HTML into the content area
    document.getElementById('content').innerHTML = videoHTML;
    
    // 2. Start the counting sequence
    startTimer();
});
</script>
</body>
</html>
