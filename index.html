<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Video-Paced Audio Pages</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
  #timer { font-size: 24px; color: red; margin-bottom: 20px; }
  
  /* CRITICAL CHANGE 1: Hide the video content initially */
  #content { display: none; } 
  
  /* NEW: Style for the start button */
  #startButton {
    padding: 15px 30px;
    font-size: 20px;
    cursor: pointer;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
  }

  /* CSS to prevent native video controls from appearing on hover/focus */
  .video-hidden::-webkit-media-controls-enclosure {
    display: none !important;
  }
  .video-hidden::-moz-media-controls-enclosure {
    display: none !important;
  }
</style>
</head>
<body>
<h1>Listening Task</h1>
<div id="timer"></div>

<div id="startContainer">
  <button id="startButton" onclick="startTask()">Start Listening Task</button>
</div>

<div id="content"></div>

<script>
let page = 1;

// --- Video Setup ---
const videoHTML = `
  <video 
    id="listeningVideo" 
    width="560" 
    height="315" 
    class="video-hidden" 
    onended="handleVideoEnd()" 
    playsinline
  >
    <source src="video.mp4" type="video/mp4"> 
    Your browser does not support the video tag.
  </video>
`;

// ðŸ›‘ CRITICAL CHANGE 1: Modified handleVideoEnd to advance pages.
function handleVideoEnd() {
    
    if (page < 3) {
        // Advance to the next page number
        page++;
        document.getElementById('timer').innerText = `Page ${page} active.`;

        // Note: The video has already ended. If you need it to play a *new* segment 
        // after this point, you will need to replace the video file path or use 
        // JavaScript to seek to the next segment's start time.
        
        // **If you are only changing the text/task based on the video's total length:**
        // You might want to display a new question/text here for Page 2, Page 3, etc.
        
        // For now, we only update the counter text.
        document.getElementById('content').innerHTML = `<h2>Page ${page}: Listening Task Active...</h2>`;


    } else {
        // Task complete after 3 pages
        document.getElementById('content').innerHTML = "<h2>All sections complete. Thank you.</h2>";
        document.getElementById('timer').innerText = "";
    }
}


// --- FUNCTION to start the task on button click ---
function startTask() {
    const startContainer = document.getElementById('startContainer');
    const content = document.getElementById('content');

    // 1. Hide the button and show the video container
    startContainer.style.display = 'none';
    content.style.display = 'block';
    
    // 2. Insert the video HTML (which is now done *after* the click)
    content.innerHTML = videoHTML;
    document.getElementById('timer').innerText = `Page ${page} active.`;

    // 3. Get the video element and manually call play()
    const videoElement = document.getElementById('listeningVideo');
    
    // Use the loadedmetadata event for robust playback assurance
    videoElement.addEventListener('loadedmetadata', attemptPlayback);
    
    // Fallback/immediate attempt if metadata is already loaded
    if (videoElement.readyState >= 1) {
        attemptPlayback();
    }
}

// Helper function for reliable playback
function attemptPlayback() {
    const videoElement = document.getElementById('listeningVideo');
    videoElement.play().catch(error => {
        console.error("Video playback failed:", error);
    });
    // Remove the event listener after the first attempt
    videoElement.removeEventListener('loadedmetadata', attemptPlayback);
}


// ðŸ›‘ CRITICAL CHANGE 2: Removed startTimer() and cleaned up DOMContentLoaded
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('timer').innerText = `Click 'Start' to begin.`;
});
</script>
</body>
</html>
