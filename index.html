<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Timed Audio Pages</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
  #timer { font-size: 24px; color: red; margin-bottom: 20px; }
  #content { display: block; }
</style>
</head>
<body>
<h1>Listening Task</h1>
<div id="timer"></div>
<div id="content"></div>

<script>
let page = 1;
let timeLeft = 120; // 120 seconds = 2 minutes

// 1. Correctly define and CLOSE the video embed string
const videoEmbed = `<iframe width="560" height="315" 
  src="https://www.youtube.com/embed/C0DPdy98e4c?autoplay=1&controls=0&modestbranding=1&mute=1"
  frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`; // <-- CLOSED!

// 2. Correctly define the function
function startTimer() {
  const maxTime = 120; 
  
  const timer = setInterval(() => {
    // 3. This line is now safe inside the function
    document.getElementById('timer').innerText = `Page ${page}: ${timeLeft} seconds left`;
    
    if (timeLeft <= 0) {
      clearInterval(timer); 
      
      if (page < 3) {
        page++;
        timeLeft = maxTime; 
        // NOTE: We do not reload content here to avoid the CSP warning.
        startTimer(); 
      } else {
        document.getElementById('content').innerHTML = "<h2>All done! Thank you.</h2>";
        document.getElementById('timer').innerText = "";
      }
    }
    
    timeLeft--; 
  }, 1000); 
}

document.addEventListener('DOMContentLoaded', () => {
    // Insert the video once on page load
    document.getElementById('content').innerHTML = videoEmbed;
    startTimer();
});
</script>
</body>
</html>
