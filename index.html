<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Video-Paced Audio Pages</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
  #timer { font-size: 24px; color: red; margin-bottom: 20px; }
  
  /* ðŸ›‘ CRITICAL CSS: Hide the video container until the button is clicked */
  #content { display: none; } 
  
  /* NEW: Style for the start button */
  #startButton {
    padding: 15px 30px;
    font-size: 20px;
    cursor: pointer;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
  }

  /* CSS to prevent native video controls from appearing on hover/focus */
  .video-hidden::-webkit-media-controls-enclosure {
    display: none !important;
  }
  .video-hidden::-moz-media-controls-enclosure {
    display: none !important;
  }
</style>
</head>
<body>
<h1>Listening Task</h1>
<div id="timer"></div>

<div id="startContainer">
  <button id="startButton" onclick="startTask()">Start Listening Task</button>
</div>

<div id="content"></div>

<script>
let page = 1;

// --- Video Setup ---
const videoHTML = `
  <video 
    id="listeningVideo" 
    width="560" 
    height="315" 
    class="video-hidden" 
    onended="handleVideoEnd()" 
    playsinline
  >
    <source src="video.mp4" type="video/mp4"> 
    Your browser does not support the video tag.
  </video>
`;

// Global handler for when the video naturally finishes playing (end of task assumed)
function handleVideoEnd() {
    
    if (page < 3) {
        // Increment page counter and update message, but the task is continuous
        page++;
        document.getElementById('timer').innerText = `Page ${page} active.`;

        // If you need to change the content/questions for the next segment, 
        // you would do it here. For now, we update the task text.
        document.getElementById('content').innerHTML = `<h2>Page ${page}: Listening Task Active...</h2>`;

    } else {
        // Task complete after 3 conceptual pages
        document.getElementById('content').innerHTML = "<h2>All sections complete. Thank you.</h2>";
        document.getElementById('timer').innerText = "";
    }
}


// --- FUNCTION to start the task on button click (linked by onclick="startTask()") ---
function startTask() {
    const startContainer = document.getElementById('startContainer');
    const content = document.getElementById('content');

    // 1. Hide the button and show the video container
    startContainer.style.display = 'none';
    content.style.display = 'block';
    
    // 2. Insert the video HTML 
    content.innerHTML = videoHTML;
    document.getElementById('timer').innerText = `Page ${page} active.`;

    // 3. Get the video element and manually call play()
    const videoElement = document.getElementById('listeningVideo');
    
    // Use the loadedmetadata event for robust playback assurance
    videoElement.addEventListener('loadedmetadata', attemptPlayback);
    
    // Fallback/immediate attempt if metadata is already loaded
    if (videoElement.readyState >= 1) {
        attemptPlayback();
    }
}

// Helper function for reliable playback
function attemptPlayback() {
    const videoElement = document.getElementById('listeningVideo');
    videoElement.play().catch(error => {
        console.error("Video playback failed:", error);
    });
    // Remove the event listener after the first attempt
    videoElement.removeEventListener('loadedmetadata', attemptPlayback);
}


// --- Initial Setup ---
document.addEventListener('DOMContentLoaded', () => {
    // Set initial text on the timer display
    document.getElementById('timer').innerText = `Click 'Start' to begin.`;
});
</script>
</body>
</html>
